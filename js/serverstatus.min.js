var error=0,d=0,server_status=new Array,urljson="https://api.status.clapse.xyz/json/stats.json";function timeSince(date){if(0==date)return"从未.";var seconds=Math.floor((new Date-date)/1e3),interval=Math.floor(seconds/31536e3);return interval>1?interval+" 年前.":(interval=Math.floor(seconds/2592e3))>1?interval+" 月前.":(interval=Math.floor(seconds/86400))>1?interval+" 日前.":(interval=Math.floor(seconds/3600))>1?interval+" 小时前.":(interval=Math.floor(seconds/60))>1?interval+" 分钟前.":"几秒前."}function bytesToSize(bytes,precision,si){var ret;if(0!=(si=void 0!==si?si:0))var kilobyte,megabyte,gigabyte,terabyte=1e3*(gigabyte=1e3*(megabyte=1e3*(kilobyte=1e3)));else var kilobyte,megabyte,gigabyte,terabyte=1024*(gigabyte=1024*(megabyte=1024*(kilobyte=1024)));if(bytes>=0&&bytes<kilobyte)return bytes+" B";if(bytes>=kilobyte&&bytes<megabyte)ret=(bytes/kilobyte).toFixed(precision)+" K";else if(bytes>=megabyte&&bytes<gigabyte)ret=(bytes/megabyte).toFixed(precision)+" M";else if(bytes>=gigabyte&&bytes<terabyte)ret=(bytes/gigabyte).toFixed(precision)+" G";else{if(!(bytes>=terabyte))return bytes+" B";ret=(bytes/terabyte).toFixed(precision)+" T"}return 0!=si?ret+"B":ret+"iB"}function uptime(){$.getJSON(urljson,(function(result){var shstr='<div class="col-lg-4 col-md-4 col-sm-4"> <div class="panel panel-block panel-block-sm panel-location"><div class="location-header"> <h3 class="h4"><img src="img/clients/@region.png"> @name <small>@type</small></h3>   <i class="zmdi zmdi-check-circle @online"></i>   </div>  <div class="location-progress">      <div class="progress progress-sm">       <div class="progress-bar" style="width: @load%;"></div>   </div>  </div> <ul class="location-info list-styled">     <li><span class="list-label">Network @network_rxandnetwork_tx</li>     <li><span class="list-label">负载状态:</span> @load%</li>   </ul>  </div> </div>',shinnerhtml="";$("#loading-notice").remove(),result.reload&&setTimeout((function(){location.reload(!0)}),1e3);for(var i=0;i<result.servers.length;i++){var newnetstr="";result.servers[i].network_rx<1e3?newnetstr+=result.servers[i].network_rx.toFixed(0)+"B":result.servers[i].network_rx<1e6?newnetstr+=(result.servers[i].network_rx/1e3).toFixed(0)+"K":newnetstr+=(result.servers[i].network_rx/1e3/1e3).toFixed(1)+"M",newnetstr+=" | ",result.servers[i].network_tx<1e3?newnetstr+=result.servers[i].network_tx.toFixed(0)+"B":result.servers[i].network_tx<1e6?newnetstr+=(result.servers[i].network_tx/1e3).toFixed(0)+"K":newnetstr+=(result.servers[i].network_tx/1e3/1e3).toFixed(1)+"M",shinnerhtml+=shstr.replace("@name",result.servers[i].name).replace("@network_rxandnetwork_tx",newnetstr).replace("@type",result.servers[i].type).replace("@online",result.servers[i].online4?"text-success":"text-error").replace("@location",result.servers[i].location).replace("@load",result.servers[i].load).replace("@load",result.servers[i].load).replace("@region",result.servers[i].region);var TableRow=$("#servers tr#r"+i),ExpandRow=$("#servers #rt"+i),hack;if(hack=i%2?"odd":"even",TableRow.length||($("#servers").append('<tr id="r'+i+'" data-toggle="collapse" data-target="#rt'+i+'" class="accordion-toggle '+hack+'"><td id="online4"><div class="progress"><div style="width: 100%;" class="progress-bar progress-bar-warning"><small>加载中</small></div></div></td><td id="name">加载中</td><td id="type">加载中</td>\x3c!-- td id="host">加载中</td --\x3e<td id="location">加载中</td><td id="uptime">加载中</td><td id="load">加载中</td><td id="network">加载中</td><td id="traffic">加载中</td><td id="cpu"><div class="progress progress-striped active"><div style="width: 100%;" class="progress-bar progress-bar-warning"><small>加载中</small></div></div></td><td id="memory"><div class="progress progress-striped active"><div style="width: 100%;" class="progress-bar progress-bar-warning"><small>加载中</small></div></div></td><td id="hdd"><div class="progress progress-striped active"><div style="width: 100%;" class="progress-bar progress-bar-warning"><small>加载中</small></div></div></td></tr><tr class="expandRow '+hack+'"><td colspan="12"><div class="accordian-body collapse" id="rt'+i+'"></tr>'),TableRow=$("#servers tr#r"+i),ExpandRow=$("#servers #rt"+i),server_status[i]=!0),TableRow=TableRow[0],error&&(TableRow.setAttribute("data-target","#rt"+i),server_status[i]=!0),result.servers[i].online4?(TableRow.children.online4.children[0].children[0].className="progress-bar progress-bar-success",TableRow.children.online4.children[0].children[0].innerHTML="<small>运行中</small>"):(TableRow.children.online4.children[0].children[0].className="progress-bar progress-bar-danger",TableRow.children.online4.children[0].children[0].innerHTML="<small>维护中</small>"),TableRow.children.name.innerHTML=result.servers[i].name,TableRow.children.type.innerHTML=result.servers[i].type,TableRow.children.location.innerHTML=result.servers[i].location,result.servers[i].online4||result.servers[i].online6){server_status[i]||(TableRow.setAttribute("data-target","#rt"+i),server_status[i]=!0),TableRow.children.uptime.innerHTML=result.servers[i].uptime,-1==result.servers[i].load?TableRow.children.load.innerHTML="–":TableRow.children.load.innerHTML=result.servers[i].load;var netstr="";result.servers[i].network_rx<1e3?netstr+=result.servers[i].network_rx.toFixed(0)+"B":result.servers[i].network_rx<1e6?netstr+=(result.servers[i].network_rx/1e3).toFixed(0)+"K":netstr+=(result.servers[i].network_rx/1e3/1e3).toFixed(1)+"M",netstr+=" | ",result.servers[i].network_tx<1e3?netstr+=result.servers[i].network_tx.toFixed(0)+"B":result.servers[i].network_tx<1e6?netstr+=(result.servers[i].network_tx/1e3).toFixed(0)+"K":netstr+=(result.servers[i].network_tx/1e3/1e3).toFixed(1)+"M",TableRow.children.network.innerHTML=netstr;var trafficstr="";result.servers[i].network_in<1024?trafficstr+=result.servers[i].network_in.toFixed(0)+"B":result.servers[i].network_in<1048576?trafficstr+=(result.servers[i].network_in/1024).toFixed(0)+"K":result.servers[i].network_in<1073741824?trafficstr+=(result.servers[i].network_in/1024/1024).toFixed(1)+"M":result.servers[i].network_in<1099511627776?trafficstr+=(result.servers[i].network_in/1024/1024/1024).toFixed(2)+"G":trafficstr+=(result.servers[i].network_in/1024/1024/1024/1024).toFixed(2)+"T",trafficstr+=" | ",result.servers[i].network_out<1024?trafficstr+=result.servers[i].network_out.toFixed(0)+"B":result.servers[i].network_out<1048576?trafficstr+=(result.servers[i].network_out/1024).toFixed(0)+"K":result.servers[i].network_out<1073741824?trafficstr+=(result.servers[i].network_out/1024/1024).toFixed(1)+"M":result.servers[i].network_out<1099511627776?trafficstr+=(result.servers[i].network_out/1024/1024/1024).toFixed(2)+"G":trafficstr+=(result.servers[i].network_out/1024/1024/1024/1024).toFixed(2)+"T",TableRow.children.traffic.innerHTML=trafficstr,result.servers[i].cpu>=90?TableRow.children.cpu.children[0].children[0].className="progress-bar progress-bar-danger":result.servers[i].cpu>=80?TableRow.children.cpu.children[0].children[0].className="progress-bar progress-bar-warning":TableRow.children.cpu.children[0].children[0].className="progress-bar progress-bar-success",TableRow.children.cpu.children[0].children[0].style.width=result.servers[i].cpu+"%",TableRow.children.cpu.children[0].children[0].innerHTML=result.servers[i].cpu+"%";var Mem=(result.servers[i].memory_used/result.servers[i].memory_total*100).toFixed(0);TableRow.children.memory.children[0].children[0].className=Mem>=90?"progress-bar progress-bar-danger":Mem>=80?"progress-bar progress-bar-warning":"progress-bar progress-bar-success",TableRow.children.memory.children[0].children[0].style.width=Mem+"%",TableRow.children.memory.children[0].children[0].innerHTML=Mem+"%";var HDD=(result.servers[i].hdd_used/result.servers[i].hdd_total*100).toFixed(0);TableRow.children.hdd.children[0].children[0].className=HDD>=90?"progress-bar progress-bar-danger":HDD>=80?"progress-bar progress-bar-warning":"progress-bar progress-bar-success",TableRow.children.hdd.children[0].children[0].style.width=HDD+"%",TableRow.children.hdd.children[0].children[0].innerHTML=HDD+"%"}else server_status[i]&&(TableRow.children.uptime.innerHTML="–",TableRow.children.load.innerHTML="–",TableRow.children.network.innerHTML="–",TableRow.children.traffic.innerHTML="–",TableRow.children.cpu.children[0].children[0].className="progress-bar progress-bar-danger",TableRow.children.cpu.children[0].children[0].style.width="100%",TableRow.children.cpu.children[0].children[0].innerHTML="<small>维护中</small>",TableRow.children.memory.children[0].children[0].className="progress-bar progress-bar-danger",TableRow.children.memory.children[0].children[0].style.width="100%",TableRow.children.memory.children[0].children[0].innerHTML="<small>维护中</small>",TableRow.children.hdd.children[0].children[0].className="progress-bar progress-bar-danger",TableRow.children.hdd.children[0].children[0].style.width="100%",TableRow.children.hdd.children[0].children[0].innerHTML="<small>维护中</small>",ExpandRow.hasClass("in")&&ExpandRow.collapse("hide"),TableRow.setAttribute("data-target",""),server_status[i]=!1)}console.log(shinnerhtml),$("#cards").html(shinnerhtml),d=new Date(1e3*result.updated),error=0})).fail((function(update_error){error||$("#servers > tr.accordion-toggle").each((function(i){var TableRow=$("#servers tr#r"+i)[0],ExpandRow=$("#servers #rt"+i);TableRow.children.online4.children[0].children[0].className="progress-bar progress-bar-error",TableRow.children.online4.children[0].children[0].innerHTML="<small>错误</small>",TableRow.children.uptime.innerHTML='<div class="progress progress-striped active"><div style="width: 100%;" class="progress-bar progress-bar-error"><small>错误</small></div></div>',TableRow.children.load.innerHTML='<div class="progress progress-striped active"><div style="width: 100%;" class="progress-bar progress-bar-error"><small>错误</small></div></div>',TableRow.children.network.innerHTML='<div class="progress progress-striped active"><div style="width: 100%;" class="progress-bar progress-bar-error"><small>错误</small></div></div>',TableRow.children.traffic.innerHTML='<div class="progress progress-striped active"><div style="width: 100%;" class="progress-bar progress-bar-error"><small>错误</small></div></div>',TableRow.children.cpu.children[0].children[0].className="progress-bar progress-bar-error",TableRow.children.cpu.children[0].children[0].style.width="100%",TableRow.children.cpu.children[0].children[0].innerHTML="<small>错误</small>",TableRow.children.memory.children[0].children[0].className="progress-bar progress-bar-error",TableRow.children.memory.children[0].children[0].style.width="100%",TableRow.children.memory.children[0].children[0].innerHTML="<small>错误</small>",TableRow.children.hdd.children[0].children[0].className="progress-bar progress-bar-error",TableRow.children.hdd.children[0].children[0].style.width="100%",TableRow.children.hdd.children[0].children[0].innerHTML="<small>错误</small>",ExpandRow.hasClass("in")&&ExpandRow.collapse("hide"),TableRow.setAttribute("data-target",""),server_status[i]=!1})),error=1,$("#updated").html("更新错误.")}))}function updateTime(){error||$("#updated").html("最后更新: "+timeSince(d))}function setActiveStyleSheet(title){var i,a,main;for(i=0;a=document.getElementsByTagName("link")[i];i++)-1!=a.getAttribute("rel").indexOf("style")&&a.getAttribute("title")&&(a.disabled=!0,a.getAttribute("title")==title&&(a.disabled=!1))}function getActiveStyleSheet(){var i,a;for(i=0;a=document.getElementsByTagName("link")[i];i++)if(-1!=a.getAttribute("rel").indexOf("style")&&a.getAttribute("title")&&!a.disabled)return a.getAttribute("title");return null}function getPreferredStyleSheet(){var i,a;for(i=0;a=document.getElementsByTagName("link")[i];i++)if(-1!=a.getAttribute("rel").indexOf("style")&&-1==a.getAttribute("rel").indexOf("alt")&&a.getAttribute("title"))return a.getAttribute("title");return null}function createCookie(name,value,days){if(days){var date=new Date;date.setTime(date.getTime()+24*days*60*60*1e3);var expires="; expires="+date.toGMTString()}else expires="";document.cookie=name+"="+value+expires+"; path=/"}function readCookie(name){for(var nameEQ=name+"=",ca=document.cookie.split(";"),i=0;i<ca.length;i++){for(var c=ca[i];" "==c.charAt(0);)c=c.substring(1,c.length);if(0==c.indexOf(nameEQ))return c.substring(nameEQ.length,c.length)}return null}uptime(),setInterval(uptime,5e3),window.onload=function(e){var cookie=readCookie("style"),title;setActiveStyleSheet(cookie||getPreferredStyleSheet())},window.onunload=function(e){var title;createCookie("style",getActiveStyleSheet(),365)};var cookie=readCookie("style"),title=cookie||getPreferredStyleSheet();setActiveStyleSheet(title);